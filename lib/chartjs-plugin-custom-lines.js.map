{"version":3,"file":"chartjs-plugin-custom-lines.js","sources":["../src/drawCustomLines.js","../src/index.js"],"sourcesContent":["const errorChecking = (line) => {\n  if (!Object.prototype.hasOwnProperty.call(line, 'from')) {\n    throw new Error('The \\'from\\' property must be specified for each line');\n  }\n\n  if (!Object.prototype.hasOwnProperty.call(line, 'to')) {\n    throw new Error('The \\'to\\' property must be specified for each line');\n  }\n\n  if (!Object.prototype.hasOwnProperty.call(line.from, 'stackIndex')) {\n    throw new Error('The \\'stackIndex\\' property must be specified for the \\'from\\' property');\n  }\n\n  if (!Object.prototype.hasOwnProperty.call(line.to, 'stackIndex')) {\n    throw new Error('The \\'stackIndex\\' property must be specified for the \\'to\\' property');\n  }\n};\n\nconst transformTopPoints = (datapointValues, top) => {\n  switch (top) {\n    case 'BR':\n      return {\n        ...datapointValues,\n        stackTRPos: datapointValues.stackBRPos,\n      };\n    case 'BL':\n      return {\n        ...datapointValues,\n        stackTLPos: datapointValues.stackBLPos,\n      };\n    case 'TR':\n      return {\n        ...datapointValues,\n        stackTLPos: datapointValues.stackTRPos,\n      };\n    case 'TL':\n      return {\n        ...datapointValues,\n        stackTRPos: datapointValues.stackTLPos,\n      };\n    default:\n      return datapointValues;\n  }\n};\n\nconst transformBottomPoints = (datapointValues, bottom) => {\n  switch (bottom) {\n    case 'BR':\n      return {\n        ...datapointValues,\n        stackBLPos: datapointValues.stackBRPos,\n      };\n    case 'BL':\n      return {\n        ...datapointValues,\n        stackBRPos: datapointValues.stackBLPos,\n      };\n    case 'TR':\n      return {\n        ...datapointValues,\n        stackBRPos: datapointValues.stackTRPos,\n      };\n    case 'TL':\n      return {\n        ...datapointValues,\n        stackBRPos: datapointValues.stackTLPos,\n      };\n    default:\n      return datapointValues;\n  }\n};\n\nconst transformPoints = (datapointValues, points = {}) => {\n  const transformedTopPoints = transformTopPoints(datapointValues, points.top);\n  const transformedPoints = transformBottomPoints(transformedTopPoints, points.bottom);\n\n  return transformedPoints;\n};\n\nconst drawCustomLine = (context, fromDatapointValues, toDatapointValues, line, options) => {\n  // Specific line options take priority over global if they are specified\n  const startColor = line.startColor || options.startColor;\n  const endColor = line.endColor || options.endColor;\n  const startColorStop = line.startColorStop || options.startColorStop;\n  const endColorStop = line.endColorStop || options.endColorStop;\n\n  let y0 = toDatapointValues.stackTLPos.y;\n  let y1 = toDatapointValues.stackBLPos.y;\n\n  if (line.reverseGradient) {\n    y0 = toDatapointValues.stackBLPos.y;\n    y1 = toDatapointValues.stackTLPos.y;\n  }\n\n  // Gradient from top of second box to bottom of second box\n  const gradient = context.createLinearGradient(0, y0, 0, y1);\n\n  gradient.addColorStop(startColorStop, startColor);\n  gradient.addColorStop(endColorStop, endColor);\n\n  context.fillStyle = gradient;\n\n  context.beginPath();\n\n  const fromTrasnformedDatapointValues = transformPoints(fromDatapointValues, line.from.points);\n  const toTrasnformedDatapointValues = transformPoints(toDatapointValues, line.to.points);\n\n  // top right of first box\n  context.lineTo(fromTrasnformedDatapointValues.stackTRPos.x, fromTrasnformedDatapointValues.stackTRPos.y);\n  // top left of second box\n  context.lineTo(toTrasnformedDatapointValues.stackTLPos.x, toTrasnformedDatapointValues.stackTLPos.y);\n  // bottom left of second box\n  context.lineTo(toTrasnformedDatapointValues.stackBLPos.x, toTrasnformedDatapointValues.stackBLPos.y);\n  // bottom right of first box\n  context.lineTo(fromTrasnformedDatapointValues.stackBRPos.x, fromTrasnformedDatapointValues.stackBRPos.y);\n\n  context.fill();\n};\n\nexport default (chart) => {\n  const context = chart.ctx;\n  const datasets = { ...chart.data.datasets };\n  const options = chart.options.plugins.customLinesPlugin;\n\n  if (!Object.prototype.hasOwnProperty.call(options, 'lines')) {\n    throw new Error('The \\'lines\\' property must be specified');\n  }\n\n  const getModel = (dataset) => {\n    const firstKey = Object.keys(dataset._meta)[0];\n\n    return dataset._meta[firstKey].data[0]._model;\n  };\n\n  const datapoints = Object.keys(datasets).map((key) => {\n    const dataset = datasets[key];\n    const model = getModel(dataset);\n\n    return {\n      stackBRPos: { x: model.x + (model.width / 2), y: model.base },\n      stackBLPos: { x: model.x - (model.width / 2), y: model.base },\n      stackTRPos: { x: model.x + (model.width / 2), y: model.y },\n      stackTLPos: { x: model.x - (model.width / 2), y: model.y },\n    };\n  });\n\n  options.lines.forEach((line) => {\n    errorChecking(line);\n\n    drawCustomLine(context, datapoints[line.from.stackIndex], datapoints[line.to.stackIndex], line, options);\n  });\n};\n","import merge from 'lodash/merge';\n\nimport drawCustomLines from './drawCustomLines';\n\nconst defaultOptions = {\n  customLinesPlugin: {\n    enabled: true,\n    startColorStop: 0,\n    endColorStop: 0.6,\n    startColor: 'rgba(0, 0, 0, 0.55)', // opaque\n    endColor: 'rgba(0, 0, 0, 0)', // transparent\n  },\n};\n\nconst status = {};\n\nconst waterFallPlugin = {\n  beforeInit: (chart) => {\n    status[chart.id] = {\n      readyToDrawCustomLines: false,\n    };\n  },\n  afterInit: (chart) => {\n    chart.options.plugins = merge({}, defaultOptions, chart.options.plugins);\n\n    // Can't override onComplete function because it gets overwridden if user using React\n    setTimeout(() => {\n      status[chart.id].readyToDrawCustomLines = true;\n      if (chart.ctx !== null) {\n        chart.draw();\n      }\n    }, chart.options.animation.duration);\n  },\n  afterDraw: (chart) => {\n    const options = chart.options.plugins.customLinesPlugin;\n\n    if (options.enabled &&\n        status[chart.id].readyToDrawCustomLines) {\n      drawCustomLines(chart);\n    }\n  },\n};\n\nexport default waterFallPlugin;\n"],"names":["errorChecking","line","Object","prototype","hasOwnProperty","call","Error","from","to","transformTopPoints","datapointValues","top","stackBRPos","stackBLPos","stackTRPos","stackTLPos","transformBottomPoints","bottom","transformPoints","points","transformedTopPoints","transformedPoints","drawCustomLine","context","fromDatapointValues","toDatapointValues","options","startColor","endColor","startColorStop","endColorStop","y0","y","y1","reverseGradient","gradient","createLinearGradient","addColorStop","fillStyle","beginPath","fromTrasnformedDatapointValues","toTrasnformedDatapointValues","lineTo","x","fill","chart","ctx","datasets","data","plugins","customLinesPlugin","getModel","dataset","firstKey","keys","_meta","_model","datapoints","map","key","model","width","base","lines","forEach","stackIndex","defaultOptions","status","waterFallPlugin","id","merge","readyToDrawCustomLines","draw","animation","duration","enabled"],"mappings":"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"}